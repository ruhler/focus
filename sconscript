
env = Environment(
        tools=['ar', 'gcc', 'g++', 'link', 'textfile'],
        CPPPATH=[],
        LIBPATH=[],
        LIBS=[]
        )

Export('env')

env['CFLAGS'] = ['-ggdb']

# define the version string.
env['VERSION'] = "1.1.0"
env.MergeFlags("-DFOCUS_VERSION_STRING=\\\\\\\"%s\\\\\\\"" % env['VERSION'])

# configuration
SConscript('config')

# Use pkg-config to extend LIBS, LIBPATH, and CPPPATH lists
for req in ['libpng', 'poppler-cpp', 'freetype2', 'fontconfig', 'sdl']:
    try:
        env.ParseConfig("pkg-config --silence-errors --cflags --libs %s" % req)
    except OSError:
        pass

# Build each of the components
for comp in env['COMPONENTS']:
    env['RELEASE'] = Dir('focus-%s/src/%s' % (env['VERSION'], comp))
    SConscript('src/%s/sconscript' % comp)

# Build the documentation
env['RELEASE'] = Dir('focus-%s/src' % env['VERSION'])
SConscript('src/sconscript')

env.Alias('install', '$PREFIX')


env['RELEASE'] = Dir('focus-%s' % env['VERSION'])
env.Install("$RELEASE", ['COPYING', 'makefile', 'sconscript', 'sconstruct'])
env.Install("$RELEASE", "#/doc")
release = env.Command('%s.tar.gz' % env['RELEASE'], "$RELEASE",
        "tar -c -f $TARGET --directory ${TARGET.dir} ${SOURCE.srcpath}")
env.Alias('release', release)

